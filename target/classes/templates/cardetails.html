<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${listing.title} + ' • CarMarket'">Car details • CarMarket</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/cardetails.css">
</head>
<body>

<header class="site-header">
    <div class="container header-content">
        <div class="logo">
            <a th:href="@{/}">CarMarket</a>
        </div>

        <nav class="main-nav">
            <a th:href="@{/cars}">Browse Cars</a>
            <a th:href="@{/postlisting}">Post Listing</a>
            <a th:href="@{/about}">About</a>
            <a th:href="@{/contact}">Contact</a>
        </nav>

        <div class="header-actions">
            <div th:if="${user == null}" class="header-actions-group">
                <a th:href="@{/login}" class="btn btn-outline">Login</a>
                <a th:href="@{/register}" class="btn btn-primary">Sign Up</a>
            </div>

            <div th:if="${user != null}" class="header-actions-group user-menu">
                <span class="user-label">
    Hi, <a th:href="@{/profile}">
        <span th:text="${user.username}">User</span>
    </a>
</span>

                <a th:href="@{/postlisting}" class="btn btn-primary">Post Listing</a>
                <a th:href="@{/my-listings}" class="btn btn-outline">My Listings</a>
                <a th:href="@{/editprofile}" class="btn btn-outline">Edit Profile</a>

                <a th:if="${user.role.name() == 'ADMIN'}"
                   th:href="@{/admin}"
                   class="btn btn-outline">
                    Admin
                </a>

                <form th:action="@{/logout}" method="post" class="inline-form">
                    <button type="submit" class="btn btn-outline">Logout</button>
                </form>
            </div>
        </div>
    </div>
</header>

<main class="page">

    <section class="hero-bar">
        <div class="container hero-content">
            <div class="hero-main">
                <a th:href="@{/cars}" class="back-link">← Back to results</a>
                <h1 th:text="${listing.title}">Car title</h1>
                <div class="hero-meta-row">
                    <div class="price-block">
                        <span class="price" th:text="'€' + ${listing.price}">€0</span>
                        <span class="price-note">Negotiable</span>
                    </div>
                    <div class="hero-tags">
                        <span class="tag">Used</span>
                        <span class="tag" th:text="${listing.fuelType}">Fuel</span>
                        <span class="tag" th:text="${listing.transmission}">Transmission</span>
                        <span class="tag" th:if="${listing.bodyType != null}" th:text="${listing.bodyType}">Body</span>
                        <span class="tag tag-location" th:text="${listing.location}">Location</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container layout">

            <div class="left-column">

                <div class="card image-card">
                    <div class="main-image">
                        <img th:if="${listing.mainImageUrl != null and !#strings.isEmpty(listing.mainImageUrl)}"
                             th:src="${listing.mainImageUrl}" alt="Car Image">
                        <div th:if="${listing.mainImageUrl == null or #strings.isEmpty(listing.mainImageUrl)}">
                            <span>Main car image</span>
                        </div>
                    </div>
                    <div class="thumb-row">
                        <div class="thumb"></div>
                        <div class="thumb"></div>
                        <div class="thumb"></div>
                        <div class="more-thumbs">+3</div>
                    </div>
                </div>

                <div class="card specs-card">
                    <h2>Key specifications</h2>
                    <div class="specs-grid">
                        <div class="spec">
                            <span class="spec-label">Year</span>
                            <span class="spec-value" th:text="${listing.year}">—</span>
                        </div>
                        <div class="spec">
                            <span class="spec-label">Mileage</span>
                            <span class="spec-value" th:text="${listing.mileageKm} + ' km'">—</span>
                        </div>
                        <div class="spec">
                            <span class="spec-label">Fuel type</span>
                            <span class="spec-value" th:text="${listing.fuelType}">—</span>
                        </div>
                        <div class="spec">
                            <span class="spec-label">Transmission</span>
                            <span class="spec-value" th:text="${listing.transmission}">—</span>
                        </div>
                        <div class="spec" th:if="${listing.bodyType != null}">
                            <span class="spec-label">Body type</span>
                            <span class="spec-value" th:text="${listing.bodyType}">—</span>
                        </div>
                        <div class="spec" th:if="${listing.engine != null}">
                            <span class="spec-label">Engine</span>
                            <span class="spec-value" th:text="${listing.engine}">—</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Description</h2>
                    <p th:text="${listing.description}">No description provided.</p>
                </div>

            </div>

            <aside class="right-column">

                <div class="card seller-card" th:if="${listing.owner != null}">
                    <div class="seller-header">
                        <div class="seller-avatar"
                             th:text="${#strings.substring(listing.owner.fullName,0,1)}">A</div>
                        <div>
                            <div class="seller-type">Private seller</div>
                            <div class="seller-name" th:text="${listing.owner.fullName}">Name</div>
                            <div class="seller-meta" th:text="${listing.owner.city}">City</div>
                        </div>
                    </div>

                    <div class="seller-info-row" th:if="${listing.owner.phoneNumber != null}">
                        <span class="info-label">Phone</span>
                        <span class="info-value" th:text="${listing.owner.phoneNumber}">Phone</span>
                    </div>

                    <div class="seller-info-row">
                        <span class="info-label">Email</span>
                        <span class="info-value" th:text="${listing.owner.email}">Email</span>
                    </div>

                    <div class="seller-actions">
                        <button type="button" class="btn btn-light btn-full">Contact via email</button>
                    </div>
                </div>

                <div class="card actions-card">
                    <h2>Actions</h2>
                    <button type="button" class="btn btn-outline btn-full">Save to favourites</button>
                    <button type="button" class="btn btn-light btn-full">Share</button>
                    <button type="button" class="btn btn-ghost btn-full btn-report">Report listing</button>
                    <p class="actions-note">If you think this listing is suspicious, report it.</p>
                </div>

                <div class="card quick-summary">
                    <h2>Summary</h2>
                    <ul>
                        <li>1 previous owner</li>
                        <li>No accidents reported</li>
                        <li>Technical inspection valid</li>
                    </ul>
                </div>

            </aside>

        </div>
    </section>

    <section class="section section-muted">
        <div class="container">
            <div class="section-header">
                <h2>Other listings</h2>
                <a th:href="@{/cars}" class="link-small">Back to all cars →</a>
            </div>

            <div class="similar-grid"
                 th:if="${otherListings != null and !#lists.isEmpty(otherListings)}">

                <article class="car-card"
                         th:each="other : ${otherListings}"
                         th:if="${other.id != listing.id}">
                    <div class="car-img">
                        <img th:if="${other.mainImageUrl != null and !#strings.isEmpty(other.mainImageUrl)}"
                             th:src="${other.mainImageUrl}"
                             alt="Car photo"
                             style="width:100%;height:100%;object-fit:cover;">
                    </div>
                    <div class="car-body">
                        <h3 th:text="${other.title}">Car title</h3>
                        <p class="price" th:text="'€' + ${other.price}">€0</p>
                        <p class="meta"
                           th:text="${other.year} + ' • ' + ${other.mileageKm} + ' km • ' + ${other.transmission}">
                            Specs
                        </p>
                        <p class="location" th:text="${other.location}">Location</p>
                        <a th:href="@{'/cars/' + ${other.id}}" class="btn btn-view">View details</a>
                    </div>
                </article>

            </div>

            <div th:if="${otherListings == null or #lists.isEmpty(otherListings)}">
                <p>No other listings to show.</p>
            </div>
        </div>
    </section>

</main>

<footer class="site-footer">
    <div class="container footer-content">
        <p>© <span id="year"></span> CarMarket. All rights reserved.</p>
        <div class="footer-links">
            <a th:href="@{/about}">About</a>
            <a th:href="@{/terms}">Terms</a>
            <a th:href="@{/privacy}">Privacy</a>
        </div>
    </div>
</footer>

<script>
    document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
