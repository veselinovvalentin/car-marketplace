<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>My Listings • CarMarket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/my-listings.css">
</head>
<body>

<header class="site-header">
  <div class="container header-content">
    <div class="logo">
      <a th:href="@{/}">CarMarket</a>
    </div>

    <nav class="main-nav">
      <a th:href="@{/cars}">Browse Cars</a>
      <a th:href="@{/postlisting}">Post Listing</a>
      <a th:href="@{/about}">About</a>
      <a th:href="@{/contact}">Contact</a>
    </nav>

    <div class="header-actions">
      <div th:if="${user == null}" class="header-actions-group">
        <a th:href="@{/login}" class="btn btn-outline">Login</a>
        <a th:href="@{/register}" class="btn btn-primary">Sign Up</a>
      </div>

      <div th:if="${user != null}" class="header-actions-group user-menu">
                <span class="user-label">
    Hi, <a th:href="@{/profile}">
        <span th:text="${user.username}">User</span>
    </a>
</span>

        <a th:href="@{/postlisting}" class="btn btn-primary">Post Listing</a>
        <a th:href="@{/my-listings}" class="btn btn-outline">My Listings</a>
        <a th:href="@{/editprofile}" class="btn btn-outline">Edit Profile</a>

        <a th:if="${user.role.name() == 'ADMIN'}"
           th:href="@{/admin}"
           class="btn btn-outline">
          Admin
        </a>

        <form th:action="@{/logout}" method="post" class="inline-form">
          <button type="submit" class="btn btn-outline">Logout</button>
        </form>
      </div>
    </div>
  </div>
</header>



<main class="page">


  <section class="hero-bar">
    <div class="container hero-content">
      <div>
        <h1>My listings</h1>
        <p>Manage, edit and keep track of all cars you’ve posted on CarMarket.</p>
      </div>
      <div class="hero-actions">
        <a th:href="@{/postlisting}" class="btn btn-primary">Post new listing</a>
      </div>
    </div>
  </section>


  <section class="section">
    <div class="container">


      <div class="stats-row">
        <div class="stat-card">
          <span class="stat-label">Total listings</span>
          <span class="stat-value" th:text="${#lists.size(listings)}">0</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Approved</span>
          <span class="stat-value"
                th:text="${#lists.size(listings.?[status.name() == 'APPROVED'])}">0</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Pending</span>
          <span class="stat-value"
                th:text="${#lists.size(listings.?[status.name() == 'PENDING'])}">0</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Drafts</span>
          <span class="stat-value"
                th:text="${#lists.size(listings.?[status.name() == 'DRAFT'])}">0</span>
        </div>
      </div>


      <div class="card">
        <div class="card-header">
          <h2>All my listings</h2>

        </div>

        <div class="table-wrapper">
          <table class="listings-table">
            <thead>
            <tr>
              <th>Title</th>
              <th>Created</th>
              <th>Status</th>
              <th>Price</th>
              <th>Location</th>
              <th class="col-actions">Actions</th>
            </tr>
            </thead>
            <tbody>

            <tr th:each="listing : ${listings}">
              <td>
                <strong th:text="${listing.title}">2019 BMW 320d</strong><br>
                <small th:text="${listing.brand + ' • ' + listing.model}">BMW • 320d</small>
              </td>

              <td th:text="${#temporals.format(listing.createdAt, 'yyyy-MM-dd')}">
                2025-03-10
              </td>

              <td>
                <span class="badge"
                      th:text="${listing.status}"
                      th:classappend="${
                        listing.status.name() == 'APPROVED' ? ' badge-active' :
                        (listing.status.name() == 'PENDING' ? ' badge-pending' :
                        (listing.status.name() == 'DRAFT' ? ' badge-draft' :
                        (listing.status.name() == 'REJECTED' ? ' badge-rejected' : '')))
                      }">
                  APPROVED
                </span>
              </td>

              <td th:text="'€' + ${listing.price}">€16,900</td>

              <td th:text="${listing.location}">Sofia, Bulgaria</td>

              <td class="col-actions">
                <a class="btn btn-table"
                   th:href="@{'/cars/' + ${listing.id}}">View</a>
                <a class="btn btn-table"
                   th:href="@{'/my-listings/' + ${listing.id} + '/edit'}">Edit</a>


              </td>
            </tr>


            <tr th:if="${#lists.isEmpty(listings)}">
              <td colspan="6" class="empty-row">
                You don't have any listings yet.
                <a th:href="@{/postlisting}">Create your first listing →</a>
              </td>
            </tr>

            </tbody>
          </table>
        </div>
      </div>

    </div>
  </section>

</main>

<footer class="site-footer">
  <div class="container footer-content">
    <p>© <span id="year"></span> CarMarket. All rights reserved.</p>
    <div class="footer-links">
      <a href="/about">About</a>
      <a href="/terms">Terms</a>
      <a href="/privacy">Privacy</a>
    </div>
  </div>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>
</body>
</html>
